<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fibonacci · ComputableDAGs.jl</title><meta name="title" content="Fibonacci · ComputableDAGs.jl"/><meta property="og:title" content="Fibonacci · ComputableDAGs.jl"/><meta property="twitter:title" content="Fibonacci · ComputableDAGs.jl"/><meta name="description" content="Documentation for ComputableDAGs.jl."/><meta property="og:description" content="Documentation for ComputableDAGs.jl."/><meta property="twitter:description" content="Documentation for ComputableDAGs.jl."/><meta property="og:url" content="https://ComputableDAGs.github.io/ComputableDAGs.jl/examples/fibonacci/"/><meta property="twitter:url" content="https://ComputableDAGs.github.io/ComputableDAGs.jl/examples/fibonacci/"/><link rel="canonical" href="https://ComputableDAGs.github.io/ComputableDAGs.jl/examples/fibonacci/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ComputableDAGs.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">ComputableDAGs.jl</a></li><li><a class="tocitem" href="../../manual/">Manual</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Fibonacci</a><ul class="internal"><li><a class="tocitem" href="#Fibonacci"><span>Fibonacci</span></a></li><li><a class="tocitem" href="#Jupyter-notebook"><span>Jupyter notebook</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/public/">Public</a></li><li><a class="tocitem" href="../../lib/internals/graph/">Graph</a></li><li><a class="tocitem" href="../../lib/internals/node/">Node</a></li><li><a class="tocitem" href="../../lib/internals/task/">Task</a></li><li><a class="tocitem" href="../../lib/internals/properties/">Properties</a></li><li><a class="tocitem" href="../../lib/internals/operation/">Operation</a></li><li><a class="tocitem" href="../../lib/internals/estimator/">Estimation</a></li><li><a class="tocitem" href="../../lib/internals/optimization/">Optimization</a></li><li><a class="tocitem" href="../../lib/internals/models/">Models</a></li><li><a class="tocitem" href="../../lib/internals/diff/">Diff</a></li><li><a class="tocitem" href="../../lib/internals/scheduler/">Scheduler</a></li><li><a class="tocitem" href="../../lib/internals/code_gen/">Code Generation</a></li><li><a class="tocitem" href="../../lib/internals/devices/">Devices</a></li><li><a class="tocitem" href="../../lib/internals/utility/">Utility</a></li></ul></li><li><a class="tocitem" href="../../contribution/">Contribution</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Fibonacci</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fibonacci</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ComputableDAGs/ComputableDAGs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ComputableDAGs/ComputableDAGs.jl/blob/main/docs/src/examples/fibonacci.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Fibonacci"><a class="docs-heading-anchor" href="#Fibonacci">Fibonacci</a><a id="Fibonacci-1"></a><a class="docs-heading-anchor-permalink" href="#Fibonacci" title="Permalink"></a></h2><p>In this example, we want to calculate the n-th Fibonacci number using a DAG representation. The input is a tuple of two numbers, the definition of <code>fib(0)</code> and <code>fib(1)</code>, to make it not just a constant Fibonacci evaluation.</p><h3 id="Model-Definition"><a class="docs-heading-anchor" href="#Model-Definition">Model Definition</a><a id="Model-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Definition" title="Permalink"></a></h3><p>To define a model for your problem type, simply define a new struct. No specific type inheritance is necessary. An object of this will later represent a specific problem instance.</p><pre><code class="language-julia hljs">using ComputableDAGs

struct Fibonacci
    n::Int
end</code></pre><p>For this example, the n in the model definition is for the <code>n-th</code> Fibonacci number we want to calculate.</p><h3 id="Task-definitions"><a class="docs-heading-anchor" href="#Task-definitions">Task definitions</a><a id="Task-definitions-1"></a><a class="docs-heading-anchor-permalink" href="#Task-definitions" title="Permalink"></a></h3><p>For Fibonacci, we only need one type of compute task: An addition of two numbers to yield the next number. Compute tasks can be defined using the <a href="../../lib/public/#ComputableDAGs.@compute_task-Tuple{Any, Any, Any}"><code>@compute_task</code></a> macro. We provide the name, the compute effort, and the function to call.</p><pre><code class="language-julia hljs">@compute_task Add 1 (+)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.Add</code></pre><h3 id="Input-definitions"><a class="docs-heading-anchor" href="#Input-definitions">Input definitions</a><a id="Input-definitions-1"></a><a class="docs-heading-anchor-permalink" href="#Input-definitions" title="Permalink"></a></h3><p>For this model, we will need two different input nodes, <code>fib(0)</code> and <code>fib(1)</code>, to base the rest of the DAG on. Input nodes are distinguished by name.</p><p>To extract the correct numbers from the CDAG input, we have to provide an expression that does so by implementing <a href="../../lib/internals/models/#ComputableDAGs.input_expr"><code>input_expr</code></a>, given the entry node&#39;s name. We&#39;ll use <code>&quot;fib(0)&quot;</code> and <code>&quot;fib(1)&quot;</code> as names.</p><pre><code class="language-julia hljs">function ComputableDAGs.input_expr(::Fibonacci, name::String, input_symbol::Symbol)
    return if (name == &quot;fib(0)&quot;)
        :($input_symbol[1])
    elseif (name == &quot;fib(1)&quot;)
        :($input_symbol[2])
    else
        assert(false)
    end
end</code></pre><p>For type inference when generating the function later, we also need to define the expected input type for our problem instance. As mentioned above, this is a <code>Tuple{Int, Int}</code> in our case.</p><pre><code class="language-julia hljs">ComputableDAGs.input_type(::Fibonacci) = Tuple{Int, Int}</code></pre><h3 id="Building-the-DAG"><a class="docs-heading-anchor" href="#Building-the-DAG">Building the DAG</a><a id="Building-the-DAG-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-DAG" title="Permalink"></a></h3><p>To be able to compute a DAG we first have to build it. This is done by implementing <a href="../../lib/internals/models/#ComputableDAGs.graph"><code>graph</code></a> for our problem instance and returning a DAG. We can use several macros to make this simple: <a href="../../lib/public/#ComputableDAGs.@assemble_dag-Tuple{Any}"><code>@assemble_dag</code></a>, <a href="../../lib/public/#ComputableDAGs.@add_call-Tuple{Any, Any, Vararg{Any}}"><code>@add_call</code></a>, <a href="../../lib/public/#ComputableDAGs.@add_entry-Tuple{Any, Any}"><code>@add_entry</code></a>.</p><pre><code class="language-julia hljs">function ComputableDAGs.graph(fib::Fibonacci)
    @assert fib.n &gt;= 2
    return @assemble_dag begin
        n1 = @add_entry &quot;fib(0)&quot; 1
        n2 = @add_entry &quot;fib(1)&quot; 1

        for _ in 3:fib.n
            n3 = @add_call Add() 1 n1 n2
            n1 = n2
            n2 = n3
        end
    end
end</code></pre><p>In short, <code>@assemble_dag begin ... end</code> creates a scope in which <a href="../../lib/public/#ComputableDAGs.@add_entry-Tuple{Any, Any}"><code>@add_entry</code></a> can add entry nodes and <a href="../../lib/public/#ComputableDAGs.@add_call-Tuple{Any, Any, Vararg{Any}}"><code>@add_call</code></a> can add compute nodes. The whole expression then returns the DAG created in the scope. <a href="../../lib/public/#ComputableDAGs.@add_entry-Tuple{Any, Any}"><code>@add_entry</code></a> takes two arguments: a node name, which is later passed to the <a href="../../lib/internals/models/#ComputableDAGs.input_expr"><code>input_expr</code></a> implementation we defined above, and the expected data size of the output. This doesn&#39;t have to be in bytes, but it should be proportional across all data sizes in the DAG. <a href="../../lib/public/#ComputableDAGs.@add_call-Tuple{Any, Any, Vararg{Any}}"><code>@add_call</code></a> takes the compute task that the compute node should execute. In our case, this is the <code>Add</code> task defined earlier. Note that this has to be an instance of the task object, not just the type name. The second argument is the expected output data size, as with the entry nodes. Finally, a list of all the input nodes to the compute task follows.</p><p>The actual logic follows that of the Fibonacci sequence:</p><p class="math-container">\[a_i = a_{i-1} + a_{i-2}\]</p><p>To achieve this, in each iteration of the for-loop, <code>n3</code> is created as a new node representing the addition of <code>n1</code> and <code>n2</code>. Then, the variables are swapped such that <code>n1</code> represents the next <span>$a_{i-2}$</span> and <code>n2</code> is the next <span>$a_{i-1}$</span>.</p><h3 id="Trying-it-out"><a class="docs-heading-anchor" href="#Trying-it-out">Trying it out</a><a id="Trying-it-out-1"></a><a class="docs-heading-anchor-permalink" href="#Trying-it-out" title="Permalink"></a></h3><p>This is all we have to do to define the problem. Now we can use ComputableDAGs.jl to generate a callable function from this definition:</p><pre><code class="language-julia hljs">fib = Fibonacci(10)
dag = graph(fib)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Graph:
  Nodes: [Node(Main.Add()), Node(DataTask(1.0)), Node(DataTask(1.0)), Node(Main.Add()), Node(DataTask(1.0)), Node(Main.Add()), Node(DataTask(1.0)), Node(Main.Add()), Node(DataTask(1.0)), Node(DataTask(1.0)), Node(Main.Add()), Node(Main.Add()), Node(DataTask(1.0)), Node(Main.Add()), Node(DataTask(1.0)), Node(Main.Add()), Node(DataTask(1.0)), Node(DataTask(1.0))]
  Edges: 24
  Total Compute Effort: 8.0
  Total Data Transfer: 16.0
  Total Compute Intensity: 0.5
</code></pre><p>Because ComputableDAGs.jl is using RuntimeGeneratedFunctions to avoid world age problems, we need to explicitly use and initialize this package before we can generate and call functions:</p><pre><code class="language-julia hljs">using RuntimeGeneratedFunctions
RuntimeGeneratedFunctions.init(@__MODULE__)

f10 = get_compute_function(dag, fib, cpu_st(), @__MODULE__);</code></pre><p>This function is now callable immediately:</p><pre><code class="language-julia hljs">using Test
@test f10((0, 1)) == 34
@test f10((5, 10)) == 445</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr32"><span class="sgr1">Test Passed</span></span></code></pre><h2 id="Jupyter-notebook"><a class="docs-heading-anchor" href="#Jupyter-notebook">Jupyter notebook</a><a id="Jupyter-notebook-1"></a><a class="docs-heading-anchor-permalink" href="#Jupyter-notebook" title="Permalink"></a></h2><p>You can download this file as a jupyter notebook <a href="../fibonacci.ipynb">here</a>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../manual/">« Manual</a><a class="docs-footer-nextpage" href="../../lib/public/">Public »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 21 October 2025 21:14">Tuesday 21 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
